---
interface Props {
  number: number;
  title: string;
  prompt: string;
  description?: string;
  category: 'women' | 'men' | 'kids';
  imagePath?: string;
}

const { number, title, prompt, description, category, imagePath } = Astro.props;
---

<div class="prompt-card group">
  <div class="prompt-header">
    <div class="prompt-number">#{number}</div>
    <h3 class="prompt-title">{title}</h3>
    <button class="copy-button" data-prompt={prompt}>
      üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
    </button>
  </div>
  
  {description && (
    <p class="prompt-description text-muted-foreground mb-4">{description}</p>
  )}
  
  <div class="prompt-content">
    <pre class="prompt-text">{prompt}</pre>
  </div>
  
  {imagePath ? (
    <div class="prompt-result">
      <p class="result-label mb-2 text-sm font-semibold">–†–µ–∑—É–ª—å—Ç–∞—Ç:</p>
      <img 
        src={imagePath} 
        alt={`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${title}`}
        loading="lazy"
        class="result-image"
      />
    </div>
  ) : (
    <div class="prompt-result-placeholder">
      <p class="placeholder-text">üñºÔ∏è –ú–µ—Å—Ç–æ –¥–ª—è —Ñ–æ—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</p>
      <p class="placeholder-hint">
        –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤: 
        <br/>
        <code class="text-xs">/public/images/results/prompt-{number}.jpg</code>
      </p>
    </div>
  )}
</div>

<script>
  function initCopyButtons() {
    document.querySelectorAll('.copy-button').forEach(button => {
      if (!(button instanceof HTMLElement)) return;
      
      // Remove existing listeners to avoid duplicates
      const newButton = button.cloneNode(true) as HTMLElement;
      button.parentNode?.replaceChild(newButton, button);
      
      newButton.addEventListener('click', async (e: Event) => {
        e.preventDefault();
        const promptText = newButton.getAttribute('data-prompt');
        if (promptText) {
          try {
            await navigator.clipboard.writeText(promptText);
            const originalText = newButton.textContent;
            newButton.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
            newButton.classList.add('copied');
            
            setTimeout(() => {
              newButton.textContent = originalText;
              newButton.classList.remove('copied');
            }, 2000);
          } catch (err) {
            console.error('Failed to copy:', err);
            newButton.textContent = '‚úó –û—à–∏–±–∫–∞';
            setTimeout(() => {
              newButton.textContent = 'üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
            }, 2000);
          }
        }
      });
    });
  }

  // Initialize on load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCopyButtons);
  } else {
    initCopyButtons();
  }
</script>

<style>
  .prompt-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }
  
  .prompt-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--accent));
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .prompt-card:hover {
    border-color: var(--accent);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
    transform: translateY(-2px);
  }
  
  .prompt-card:hover::before {
    opacity: 1;
  }
  
  [data-theme="dark"] .prompt-card {
    background: rgba(20, 20, 20, 0.7);
    backdrop-filter: blur(10px);
  }
  
  [data-theme="dark"] .prompt-card:hover {
    box-shadow: 0 8px 30px rgba(0, 212, 255, 0.2),
                0 0 40px rgba(0, 212, 255, 0.1);
    border-color: var(--neon-blue);
  }
  
  .prompt-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }
  
  .prompt-number {
    background: var(--primary);
    color: var(--primary-foreground);
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-weight: 600;
    font-size: var(--text-sm);
  }
  
  .prompt-title {
    flex: 1;
    font-size: 1.125rem;
    font-weight: 600;
    margin: 0;
    min-width: 200px;
  }
  
  .copy-button {
    background: transparent;
    border: 1px solid var(--border);
    padding: 0.5rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 0.875rem;
    white-space: nowrap;
    font-weight: 500;
  }
  
  .copy-button:hover {
    background: var(--accent);
    border-color: var(--accent);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  
  [data-theme="dark"] .copy-button:hover {
    box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3),
                0 0 20px rgba(0, 212, 255, 0.2);
    background: rgba(0, 212, 255, 0.1);
    border-color: var(--neon-blue);
    color: var(--neon-blue);
  }
  
  .copy-button.copied {
    background: #10b981;
    border-color: #10b981;
    color: white;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }
  
  .prompt-content {
    background: var(--muted);
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    overflow-x: auto;
    border: 1px solid var(--border);
  }
  
  [data-theme="dark"] .prompt-content {
    background: rgba(20, 20, 20, 0.8);
    border-color: rgba(255, 255, 255, 0.1);
  }
  
  .prompt-content pre {
    margin: 0;
    white-space: pre-wrap;
    word-wrap: break-word;
    font-family: var(--font-mono);
    font-size: 0.875rem;
    line-height: 1.6;
    color: var(--foreground);
  }
  
  [data-theme="dark"] .prompt-content pre {
    color: rgba(250, 250, 250, 0.95);
  }
  
  .result-image {
    width: 100%;
    max-width: 400px;
    border-radius: 8px;
    margin-top: 0.5rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }
  
  .prompt-result-placeholder {
    background: var(--muted);
    border: 2px dashed var(--border);
    border-radius: 8px;
    padding: 2rem;
    text-align: center;
  }
  
  .placeholder-text {
    font-size: 1.125rem;
    margin-bottom: 0.5rem;
  }
  
  .placeholder-hint {
    font-size: 0.875rem;
    color: var(--muted-foreground);
  }
  
  .placeholder-hint code {
    background: var(--background);
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-family: var(--font-mono);
  }
</style>
