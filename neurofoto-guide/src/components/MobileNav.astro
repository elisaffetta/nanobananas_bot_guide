---
import Navigation from './Navigation.astro';
---

<div class="md:hidden">
  <button id="mobile-menu-btn" class="inline-flex items-center justify-center rounded-md p-2 text-muted-foreground hover:bg-accent hover:text-accent-foreground focus:outline-none" aria-label="Menu">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6"><line x1="3" x2="21" y1="6" y2="6"/><line x1="3" x2="21" y1="12" y2="12"/><line x1="3" x2="21" y1="18" y2="18"/></svg>
  </button>

  <div id="mobile-menu-overlay" class="fixed inset-0 z-[9998] hidden animate-in fade-in-0"></div>
  
  <div id="mobile-menu-content" class="fixed inset-0 z-[9999] w-full shadow-2xl transition-transform duration-300 ease-in-out -translate-x-full mobile-menu-container">
    <div class="flex items-center justify-between p-6 pb-4 mobile-menu-header">
        <a href="https://t.me/nanobananas_bot" target="_blank" rel="noopener noreferrer" class="font-bold text-lg hover:text-primary transition-colors">üçå @nanobananas_bot</a>
        <button id="mobile-menu-close" class="rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-5 w-5"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>
            <span class="sr-only">Close</span>
        </button>
    </div>
    <div class="overflow-y-auto px-6 pb-6 mobile-menu-nav" style="height: calc(100vh - 5rem);">
        <Navigation />
    </div>
  </div>
</div>

<script>
  function initMobileMenu() {
    const btn = document.getElementById('mobile-menu-btn');
    const closeBtn = document.getElementById('mobile-menu-close');
    const overlay = document.getElementById('mobile-menu-overlay');
    const menu = document.getElementById('mobile-menu-content');
    
    if (!btn || !closeBtn || !overlay || !menu) return;
    
    const navLinks = menu.querySelectorAll('a');

    function openMenu() {
      if (!overlay || !menu) return;
      overlay.classList.remove('hidden');
      menu.classList.remove('-translate-x-full');
      document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
      if (!overlay || !menu) return;
      overlay.classList.add('hidden');
      menu.classList.add('-translate-x-full');
      document.body.style.overflow = '';
      // Remove blur from main content
      const mainContent = document.querySelector('main');
      const header = document.querySelector('header');
      if (mainContent) mainContent.style.filter = '';
      if (header) header.style.filter = '';
    }

    btn.addEventListener('click', openMenu);
    closeBtn.addEventListener('click', closeMenu);
    overlay.addEventListener('click', closeMenu);

    // Close on link click
    navLinks.forEach(link => {
      link.addEventListener('click', closeMenu);
    });
  }
  
  // Initialize immediately if DOM is ready, otherwise wait
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMobileMenu);
  } else {
    initMobileMenu();
  }
</script>

<style>
  /* Overlay - –ë–ï–ó backdrop-filter */
  #mobile-menu-overlay {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
  
  [data-theme="dark"] #mobile-menu-overlay {
    background: rgba(0, 0, 0, 0.95) !important;
  }
  
  [data-theme="light"] #mobile-menu-overlay {
    background: rgba(255, 255, 255, 0.95) !important;
  }
  
  /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–µ–Ω—é - –ü–û–õ–ù–û–°–¢–¨–Æ –ë–ï–ó backdrop-filter */
  #mobile-menu-content {
    position: fixed !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
  
  [data-theme="dark"] #mobile-menu-content {
    background: #0a0a0a !important;
  }
  
  [data-theme="light"] #mobile-menu-content {
    background: #ffffff !important;
  }
  
  /* Header –º–µ–Ω—é - –ë–ï–ó backdrop-filter */
  .mobile-menu-header {
    background: inherit !important;
    border-bottom: 1px solid var(--border);
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
  
  /* –û–±–ª–∞—Å—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ - –ü–û–õ–ù–û–°–¢–¨–Æ –ë–ï–ó backdrop-filter */
  .mobile-menu-nav {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }
  
  [data-theme="dark"] .mobile-menu-nav {
    background: #0a0a0a !important;
  }
  
  [data-theme="light"] .mobile-menu-nav {
    background: #ffffff !important;
  }
  
  /* –¢–µ–∫—Å—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å */
  .mobile-menu-nav * {
    position: relative !important;
    z-index: 1 !important;
  }
  
  [data-theme="dark"] .mobile-menu-nav a,
  [data-theme="dark"] .mobile-menu-nav h2,
  [data-theme="dark"] .mobile-menu-nav h4,
  [data-theme="dark"] .mobile-menu-nav span,
  [data-theme="dark"] .mobile-menu-nav div {
    color: rgba(255, 255, 255, 0.95) !important;
    background: transparent !important;
  }
  
  [data-theme="light"] .mobile-menu-nav,
  [data-theme="light"] .mobile-menu-nav *,
  [data-theme="light"] .mobile-menu-nav a,
  [data-theme="light"] .mobile-menu-nav h2,
  [data-theme="light"] .mobile-menu-nav h4,
  [data-theme="light"] .mobile-menu-nav span,
  [data-theme="light"] .mobile-menu-nav div,
  [data-theme="light"] .mobile-menu-nav p {
    color: #1a1a1a !important;
  }
  
  /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ - —á—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ */
  [data-theme="light"] .mobile-menu-nav h4 {
    color: #666666 !important;
  }
  
  /* –°—Å—ã–ª–∫–∏ –≤ —Å–≤–µ—Ç–ª–æ–π —Ç–µ–º–µ */
  [data-theme="light"] .mobile-menu-nav a {
    color: #1a1a1a !important;
  }
  
  [data-theme="light"] .mobile-menu-nav a:hover {
    color: #000000 !important;
  }
  
  /* –£–±–∏—Ä–∞–µ–º –ª—é–±—ã–µ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Ñ–æ–Ω—ã –∏–∑ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
  .mobile-menu-nav .nav-section,
  .mobile-menu-nav .space-y-6,
  .mobile-menu-nav .space-y-0\.5 {
    background: transparent !important;
  }
</style>
