---
// Navigation.astro
interface NavSubItem {
  href: string;
  label: string;
}

interface NavItem {
  href: string;
  label: string;
  icon: string;
  subItems?: NavSubItem[];
}

interface NavSection {
  title: string;
  items: NavItem[];
}

const navSections: NavSection[] = [
  {
    title: 'üìñ –û—Å–Ω–æ–≤—ã',
    items: [
      { href: '#intro', label: '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ', icon: 'üëã' },
      { href: '#cases', label: '–ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ', icon: 'üéØ' },
      { href: '#functionality', label: '–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–æ—Ç–∞', icon: 'ü§ñ' },
    ]
  },
  {
    title: 'üéì –û–±—É—á–µ–Ω–∏–µ',
    items: [
      { href: '#rules', label: '–ü—Ä–∞–≤–∏–ª–∞ –∏ —Å–µ–∫—Ä–µ—Ç—ã', icon: 'üìö' },
    ]
  },
  {
    title: '‚ú® –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–æ–º—Ç–æ–≤',
    items: [
      { 
        href: '#prompts-women', 
        label: '–ñ–µ–Ω—Å–∫–∏–µ –ø—Ä–æ–º—Ç—ã', 
        icon: 'üë©üèº',
        subItems: [
          { href: '#women-newyear', label: '–ó–∏–º–∞ & –ù–æ–≤—ã–π –≥–æ–¥' },
          { href: '#women-business', label: '–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ' },
          { href: '#women-style', label: '–°—Ç–∏–ª—å & –ú–æ–¥–∞' },
          { href: '#women-social', label: '–°–æ—Ü—Å–µ—Ç–∏' },
          { href: '#women-urban', label: '–ì–æ—Ä–æ–¥' },
          { href: '#women-nature', label: '–ü—Ä–∏—Ä–æ–¥–∞' },
        ]
      },
      { 
        href: '#prompts-men', 
        label: '–ú—É–∂—Å–∫–∏–µ –ø—Ä–æ–º—Ç—ã', 
        icon: 'üë®üèº', 
        subItems: [
          { href: '#men-business', label: '–ë–∏–∑–Ω–µ—Å & –ö–∞—Ä—å–µ—Ä–∞' },
          { href: '#men-lifestyle', label: '–õ–∞–π—Ñ—Å—Ç–∞–π–ª' },
          { href: '#men-style', label: '–°—Ç–∏–ª—å & –ê—Ç–º–æ—Å—Ñ–µ—Ä–∞' },
        ]
      },
      { 
        href: '#prompts-kids', 
        label: '–î–µ—Ç—Å–∫–∏–µ –ø—Ä–æ–º—Ç—ã', 
        icon: 'üë∂üèº',
        subItems: [
          { href: '#kids-fantasy', label: '–ü—Ä–∞–∑–¥–Ω–∏–∫–∏ & –ú–∞–≥–∏—è' },
          { href: '#kids-daily', label: '–•–æ–±–±–∏ & –ñ–∏–∑–Ω—å' },
        ]
      },
    ]
  },
  {
    title: 'üí¨ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
    items: [
      { href: '#about', label: '–û –Ω–∞—Å', icon: 'üë•' },
      { href: '#conclusion', label: '–ù–∞—á–∞—Ç—å', icon: 'üöÄ' },
    ]
  }
];
---

<nav class="space-y-6 py-2">
    <div class="px-3 mb-3">
      <h2 class="text-base font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent">
        –ù–∞–≤–∏–≥–∞—Ü–∏—è
      </h2>
    </div>
    
    {navSections.map(section => (
      <div class="nav-section">
        <h4 class="px-3 mb-1 text-xs font-bold uppercase tracking-wider text-muted-foreground/70">
          {section.title}
        </h4>
        <div class="space-y-0.5">
          {section.items.map(item => (
            <div class="nav-item-wrapper">
              <div class="flex items-center gap-1">
                <a 
                  href={item.href}
                  class="nav-link group flex-1 flex items-center gap-2 rounded-lg px-3 py-1.5 text-sm font-medium transition-all duration-200 hover:scale-[1.02]"
                >
                  <span class="text-lg group-hover:scale-110 transition-transform duration-200">{item.icon}</span>
                  <span class="flex-1">{item.label}</span>
                </a>
                {item.subItems && (
                  <button 
                    class="accordion-toggle w-8 h-8 flex items-center justify-center rounded-md hover:bg-muted text-muted-foreground transition-colors"
                    aria-label="–†–∞—Å–∫—Ä—ã—Ç—å —Ä–∞–∑–¥–µ–ª"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transition-transform duration-200">
                      <path d="m6 9 6 6 6-6"/>
                    </svg>
                  </button>
                )}
              </div>
              
              {item.subItems && (
                <div class="nav-submenu hidden pl-9 pr-2 space-y-0.5 overflow-hidden transition-all duration-300">
                  {item.subItems.map(sub => (
                    <a 
                      href={sub.href}
                      class="block rounded-md px-2 py-1 text-xs text-muted-foreground hover:text-foreground hover:bg-muted/50 transition-colors"
                    >
                      {sub.label}
                    </a>
                  ))}
                </div>
              )}
            </div>
          ))}
        </div>
      </div>
    ))}
    
    <div class="mt-4 px-3">
      <a 
        href="https://t.me/nanobananas_bot" 
        target="_blank"
        rel="noopener noreferrer"
        class="flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-primary to-accent px-3 py-2 text-sm font-bold text-primary-foreground shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-200"
      >
        <span>üçå</span>
        <span>–û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞</span>
      </a>
    </div>
</nav>

<script>
// Intersection Observer for active section highlighting
const sections = document.querySelectorAll('section[id]');
const navLinks = document.querySelectorAll('.nav-link, .nav-submenu a');

const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      // Deactivate all
      navLinks.forEach(link => {
          link.classList.remove('active', 'text-foreground', 'bg-muted');
          link.classList.add('text-muted-foreground');
          
          // Reset main link styles if it's a submenu link
          if (link.classList.contains('nav-link')) {
             link.classList.remove('text-muted-foreground'); // nav-link handles its own color mostly via css but let's be safe
          }
      });
      
      const activeLink = document.querySelector(`a[href="#${entry.target.id}"]`);
      if (activeLink) {
        activeLink.classList.remove('text-muted-foreground');
        
        if (activeLink.classList.contains('nav-link')) {
            activeLink.classList.add('active', 'text-foreground', 'bg-muted');
        } else {
            // It's a submenu link
            activeLink.classList.add('text-foreground', 'bg-muted/50', 'font-medium');
            
            // Also highlight parent? Maybe later.
            // Open parent accordion if closed
            const submenu = activeLink.closest('.nav-submenu');
            if (submenu && submenu.classList.contains('hidden')) {
                submenu.classList.remove('hidden');
                const toggle = submenu.previousElementSibling?.querySelector('.accordion-toggle');
                if (toggle) {
                    toggle.querySelector('svg')?.classList.add('rotate-180');
                }
            }
        }
      }
    }
  });
}, { threshold: 0.2, rootMargin: "-20% 0px -50% 0px" });

sections.forEach(section => observer.observe(section));

// Accordion functionality
document.querySelectorAll('.accordion-toggle').forEach(toggle => {
    toggle.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        const wrapper = toggle.closest('.nav-item-wrapper');
        const submenu = wrapper?.querySelector('.nav-submenu');
        const icon = toggle.querySelector('svg');
        
        if (submenu && icon) {
            submenu.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
        }
    });
});

// Smooth scroll
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e: Event) {
    e.preventDefault();
    const href = (e.currentTarget as HTMLAnchorElement).getAttribute('href');
    if (href) {
      const target = document.querySelector(href);
      if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          history.pushState(null, '', href);
      }
    }
  });
});
</script>

<style>
    .nav-link {
        color: var(--muted-foreground);
        position: relative;
    }
    
    .nav-link:hover {
        color: var(--foreground);
        background: var(--accent);
    }
    
    .nav-link.active {
        color: var(--foreground);
        background: var(--muted);
        font-weight: 600;
        border-left: 3px solid var(--primary);
        padding-left: calc(0.75rem - 3px);
    }
    
    [data-theme="dark"] .nav-link:hover {
        background: rgba(0, 212, 255, 0.1);
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.1);
    }
    
    [data-theme="dark"] .nav-link.active {
        border-left-color: var(--neon-blue);
        background: rgba(0, 212, 255, 0.15);
        box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
    }
    
    .nav-indicator {
        color: var(--primary);
        font-weight: bold;
    }
    
    [data-theme="dark"] .nav-indicator {
        color: var(--neon-blue);
        text-shadow: 0 0 10px var(--neon-blue);
    }
    
    .nav-section {
        padding-bottom: 0.75rem;
    }
</style>
